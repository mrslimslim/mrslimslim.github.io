(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{417:function(t,a,s){"use strict";s.r(a);var e=s(44),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"prefetch-和-preload-的应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prefetch-和-preload-的应用场景"}},[t._v("#")]),t._v(" prefetch 和 preload 的应用场景")]),t._v(" "),s("h2",{attrs:{id:"preload-介绍和使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preload-介绍和使用"}},[t._v("#")]),t._v(" preload 介绍和使用")]),t._v(" "),s("p",[t._v("preload 提供了一种声明式的命令，让浏览器可以提前加载高优先级资源(不执行)，在需要执行的时候执行。")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("将加载和执行分离")]),t._v("，不会阻塞 document 的 onload 事件")]),t._v(" "),s("li",[t._v("提升资源(font, style, javascript)加载的优先级，解决如(优化)字体闪动的问题")])]),t._v(" "),s("p",[t._v("使用了 preload\n"),s("img",{attrs:{src:"https://blog-1253253332.cos.ap-guangzhou.myqcloud.com/images/preload.png",alt:"使用了preload"}})]),t._v(" "),s("p",[t._v("没有使用 preload\n"),s("img",{attrs:{src:"https://blog-1253253332.cos.ap-guangzhou.myqcloud.com/images/%E6%B2%A1%E6%9C%89preload.png",alt:"没有使用preload"}})]),t._v(" "),s("h3",{attrs:{id:"使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[t._v("#")]),t._v(" 使用方法")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("as")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("//at.alicdn.com/t/font_1175572_qt0ubitzjhl.css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token special-attr"}},[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onload")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stylesheet'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("link")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"preload-注意"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preload-注意"}},[t._v("#")]),t._v(" preload 注意")]),t._v(" "),s("ol",[s("li",[s("p",[s("em",[t._v("目前浏览器基本上都具备预测解析能力，可以提前解析入口 html 中外链的资源，因此入口脚本文件、样式文件等不需要特意进行 preload。")]),t._v(" 因此我们主要使用的场景是处理 FOUT(flash of unstyled Text )，在网速较差的情况下，字体未来得及的加载下,文字的闪动。")])]),t._v(" "),s("li",[s("p",[t._v("但是一些隐藏在 CSS 和 JavaScript 中的资源，如字体文件，本身是首屏关键资源，但当 css 文件解析之后才会被浏览器加载。这种场景适合使用 preload 进行声明，尽早进行资源加载，避免页面渲染延迟。")])]),t._v(" "),s("li",[s("p",[t._v("preload 是提前加载，但是不会执行，如果需要加载后执行，需要添加属性 onload = \"this.rel = 'stylesheet'\"(js 的话需要手动载入)")])]),t._v(" "),s("li",[s("p",[t._v("字体 font 使用 preload 需要添加 crossorigin 属性，否则会导致二次加载(浏览器会采用匿名模式的 CORS 去 preload，导致两次请求无法共用缓存。)")])]),t._v(" "),s("li",[s("p",[t._v("导致 window.onload 提前执行，造成 js 执行不符合预期，window.getComputeStyle()获取错误")])])]),t._v(" "),s("h3",{attrs:{id:"最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[t._v("#")]),t._v(" 最佳实践")]),t._v(" "),s("ol",[s("li",[t._v("大部分场景下无需特意的使用 preload")]),t._v(" "),s("li",[t._v("隐藏在 css 里面的字体(font face)、样式中的首屏加载关键资源，建议是用 preload")]),t._v(" "),s("li",[t._v("异步加载的模块中的非首页(js, image)建议使用 prefetch")]),t._v(" "),s("li",[t._v("可以使用 preload-webpack-plugin 在 webpack 中对资源进行 preload 优化")])]),t._v(" "),s("h2",{attrs:{id:"prefetch-介绍和使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prefetch-介绍和使用"}},[t._v("#")]),t._v(" prefetch 介绍和使用")]),t._v(" "),s("p",[t._v("prefetch 针对页面中的一些必需但是低优先级的资源，比如非首页的 js 和图片样式资源。当用户访问其中一个预读文档，就可以快速的浏览器的缓存中获取。")]),t._v(" "),s("p",[t._v("使用方法")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/images/big.jpeg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("h3",{attrs:{id:"prefetch-注意点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prefetch-注意点"}},[t._v("#")]),t._v(" prefetch 注意点")]),t._v(" "),s("ol",[s("li",[t._v("当资源被预加载的时候点击某个链接时，当前 prefetch 操作会被丢弃")])]),t._v(" "),s("h2",{attrs:{id:"dns-prefetch-介绍和使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dns-prefetch-介绍和使用"}},[t._v("#")]),t._v(" dns-prefetch 介绍和使用")]),t._v(" "),s("p",[t._v("*dns-prefetch(DNS 预获取)*是前端网络性能优化的一种措施。它根据浏览器定义的规则，提前解析之后可能会用到的域名，使解析结果缓存到系统缓存中，缩短 DNS 解析时间，进而提高网站的访问速度。")]),t._v(" "),s("p",[t._v("dns 虽然占用不了很多带宽，但是可能产生很高的延迟。")]),t._v(" "),s("h3",{attrs:{id:"dns-prefetch-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dns-prefetch-使用"}},[t._v("#")]),t._v(" dns-prefetch 使用")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("dns-prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://baidu.com/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("link")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"dns-缓存获取优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dns-缓存获取优先级"}},[t._v("#")]),t._v(" DNS 缓存获取优先级")]),t._v(" "),s("p",[t._v("当浏览器访问一个域名的时候，需要解析一次 DNS，获得对应域名的 ip 地址。 在解析过程中，按照:")]),t._v(" "),s("ol",[s("li",[t._v("浏览器缓存")]),t._v(" "),s("li",[t._v("系统缓存")]),t._v(" "),s("li",[t._v("路由器缓存")]),t._v(" "),s("li",[t._v("ISP(运营商)DNS 缓存")]),t._v(" "),s("li",[t._v("根域名服务器")]),t._v(" "),s("li",[t._v("顶级域名服务器")]),t._v(" "),s("li",[t._v("主域名服务器")])]),t._v(" "),s("h3",{attrs:{id:"注意点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意点"}},[t._v("#")]),t._v(" 注意点")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("dns-prefetch 仅对跨域的的域名生效")])]),t._v(" "),s("li",[s("p",[t._v("dns-prefetch 可以与 preconnect 搭配使用，将两者结合起来可提供进一步减少跨域请求的感知延迟的机会。如下所示：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preconnect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://fonts.gstatic.com/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://fonts.gstatic.com/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("如果页面需要建立与许多第三方域的连接，则将它们预先连接会适得其反。 preconnect 提示最好仅用于最关键的连接。对于其他的，只需使用 "),s("code",[t._v('<link rel="dns-prefetch"/ >')]),t._v(" 即可节省第一步的时间 DNS 查找。")])])]),t._v(" "),s("h2",{attrs:{id:"preconnect-介绍和使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preconnect-介绍和使用"}},[t._v("#")]),t._v(" preconnect 介绍和使用")]),t._v(" "),s("p",[t._v("总所周知，我们与服务器发生通信前会经过 dns 解析和初始化连接和 SSL 连接等步骤，但是 preconnect 能帮助我们提早建立与域的连接")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://blog-1253253332.cos.ap-guangzhou.myqcloud.com/images/preconnect.png",alt:"preconnect"}})]),t._v(" "),s("h3",{attrs:{id:"preconnect-注意点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preconnect-注意点"}},[t._v("#")]),t._v(" preconnect 注意点")]),t._v(" "),s("ol",[s("li",[t._v("通过 preconnect 和别的域建立连接后，"),s("em",[t._v("应该尽快的使用它，因为浏览器会关闭所有在 10 秒内未使用的连接。不必要的预连接会延迟其他重要资源，因此要限制 preconnect 连接域的数量")]),t._v("。")]),t._v(" "),s("li",[t._v("需要添加 crossorigin 属性")]),t._v(" "),s("li",[t._v("preconnect 的兼容性比 dns-prefetch 的兼容性差一点")])]),t._v(" "),s("h3",{attrs:{id:"使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[t._v("#")]),t._v(" 使用场景")]),t._v(" "),s("ol",[s("li",[t._v("对于媒体播放的优化，比如博客嵌入了 bilibili 的播放器，在未播放前对 preconnect，优化加载速度。")]),t._v(" "),s("li",[t._v("对于资源是哪个域名下的但是不知道是具体哪个资源。")])])])}),[],!1,null,null,null);a.default=n.exports}}]);