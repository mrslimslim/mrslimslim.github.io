(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{398:function(t,a,s){t.exports=s.p+"assets/img/http-cache.a101e3b2.png"},441:function(t,a,s){"use strict";s.r(a);var e=s(56),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"http-缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http-缓存"}},[t._v("#")]),t._v(" http 缓存")]),t._v(" "),e("p",[e("img",{attrs:{src:s(398),alt:"http cache"}})]),t._v(" "),e("h3",{attrs:{id:"_1-作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-作用"}},[t._v("#")]),t._v(" 1. 作用")]),t._v(" "),e("p",[t._v("针对一些诸如js,css等改动较少的文件，如果不缓存就会重新请求，会受网络因素影响，导致体验不好，给服务器也会带来压力。")]),t._v(" "),e("h3",{attrs:{id:"_2-种类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-种类"}},[t._v("#")]),t._v(" 2. 种类")]),t._v(" "),e("p",[t._v("强缓存和协商缓存")]),t._v(" "),e("p",[t._v("强缓存不发送请求到服务器，根据保质期字段max-age，Expires来判断是否缓存"),e("br"),t._v("\n协商缓存会请求服务，通过服务器来判断资源是否判断是否新鲜，相关的字段是if-none-match/etag,last-modified-since/last-modified")]),t._v(" "),e("p",[t._v("强缓存 状态码 200\n协商缓存 状态码 304")]),t._v(" "),e("h3",{attrs:{id:"_3-相关响应请求头"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-相关响应请求头"}},[t._v("#")]),t._v(" 3. 相关响应请求头")]),t._v(" "),e("h4",{attrs:{id:"_3-1-cache-control"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-cache-control"}},[t._v("#")]),t._v(" 3.1 Cache-control")]),t._v(" "),e("p",[e("strong",[t._v("响应/请求头， 缓存策略")])]),t._v(" "),e("p",[t._v("value:")]),t._v(" "),e("ol",[e("li",[t._v("no-store 不使用缓存，每次都请求服务器")]),t._v(" "),e("li",[t._v("no-cache 不走强缓存，和服务器确认新鲜度")]),t._v(" "),e("li",[t._v("max-age 单位:秒,新鲜度维持的相对时间，这段时间不会向发起请求。")]),t._v(" "),e("li",[t._v("s-max-age 单位：秒，新鲜度维持的相对时间，对代理服务器有效(cdn)")]),t._v(" "),e("li",[t._v("public 客户端和服务端都缓存")]),t._v(" "),e("li",[t._v("private 客户端缓存")])]),t._v(" "),e("h4",{attrs:{id:"_3-2-expires"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-expires"}},[t._v("#")]),t._v(" 3.2 Expires")]),t._v(" "),e("p",[e("strong",[t._v("响应头 资源过期时间")])]),t._v(" "),e("p",[t._v("value: string GMT格式，http1.0属性，在max-age共存的情况下优先级低一些")]),t._v(" "),e("h4",{attrs:{id:"_3-3-last-modified"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-last-modified"}},[t._v("#")]),t._v(" 3.3 Last-Modified")]),t._v(" "),e("p",[e("strong",[t._v("响应头 资源上一次修改时间")])]),t._v(" "),e("p",[t._v("value: string")]),t._v(" "),e("h4",{attrs:{id:"_3-4-last-modified-since"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-last-modified-since"}},[t._v("#")]),t._v(" 3.4 Last-Modified-since")]),t._v(" "),e("p",[e("strong",[t._v("请求头 浏览器记录资源最新修改时间，会和服务器Last-Modified对比")])]),t._v(" "),e("p",[t._v("value: string")]),t._v(" "),e("h4",{attrs:{id:"_3-5-etag"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-etag"}},[t._v("#")]),t._v(" 3.5 Etag")]),t._v(" "),e("p",[e("strong",[t._v("响应头 资源标识符，资源的身份证")])]),t._v(" "),e("p",[t._v("value: string")]),t._v(" "),e("h4",{attrs:{id:"_3-6-if-none-match"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-if-none-match"}},[t._v("#")]),t._v(" 3.6 if-None-Match")]),t._v(" "),e("p",[e("strong",[t._v("请求头  浏览器记录的资源上一次的身份证，用来和服务器的Etag对比")])]),t._v(" "),e("h3",{attrs:{id:"_4-最佳实践"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-最佳实践"}},[t._v("#")]),t._v(" 4. 最佳实践")]),t._v(" "),e("p",[t._v("HTML：使用协商缓存\nCSS&JS:webpack打包contentHash，使用强缓存, Cache-Control: public,max-age=31536000,immutable")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cache"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("control"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age:30000;public'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h3",{attrs:{id:"_5-其他"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-其他"}},[t._v("#")]),t._v(" 5. 其他")]),t._v(" "),e("p",[t._v("Service Worker, push cache（http2）")])])}),[],!1,null,null,null);a.default=r.exports}}]);